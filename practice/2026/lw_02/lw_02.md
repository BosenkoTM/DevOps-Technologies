# Лабораторная работа №2. Упаковка многокомпонентного аналитического приложения с помощью Docker и Docker Compose


## Цель работы
Научиться создавать оптимизированные Docker-образы для аналитических приложений (Python/Data Science стек) и оркестрировать взаимодействие нескольких сервисов (ETL-скрипт, База Данных, Визуализация) с помощью Docker Compose, обеспечивая сохранение данных и безопасное управление конфигурацией.

## Исходные данные и инструменты
Используется кодовая база и наборы данных, подготовленные в **Лабораторной работе №1**.
Теперь локальный проект необходимо превратить в переносимый микросервисный продукт.

**Архитектура решения:**
-  **Service `db`**. База данных для хранения обработанных метрик (PostgreSQL или MongoDB).
-  **Service `loader` (init)**. Одноразовый (ephemeral) контейнер. Выполняет роль ETL-скрипта: запускается, читает сырые данные (CSV/JSON из ЛР1), загружает их в БД и завершает работу.
-  **Service `analytics_app`**. Основное приложение (Streamlit, Flask API или JupyterLab), которое подключается к БД, забирает данные и отображает результаты/дашборд.

## Ход работы

### Этап 1. Разработка оптимизированного Dockerfile
Для сервиса `analytics_app` необходимо написать `Dockerfile`, соблюдая "Хорошие практики":
-  **Базовый образ.** Использовать конкретные версии (например, `python:3.10-slim`, а не `latest`).
-  **Пользователь.** Создать и использовать непривилегированного пользователя (`UID 1000`), не запускать от `root`.
-  **Слои и кэш.** Объединять команды `RUN`, устанавливать зависимости (`pip install`) до копирования основного кода (`COPY . .`), чтобы использовать кэш Docker.
-  **Очистка.** Удалять кэш пакетного менеджера (`rm -rf /var/lib/apt/lists/*` или `--no-cache-dir`).
-  **`.dockerignore`.** Исключить `venv`, `.git`, `__pycache__` и локальные файлы данных.

### Этап 2. Настройка Docker Compose
Создать файл `docker-compose.yml`, описывающий инфраструктуру:
-  **Depends_on.** Настроить порядок запуска (приложение ждет БД). Использовать `condition: service_healthy` (healthchecks).
-  **Volumes:**
    *   Для БД: именованный том (named volume) для сохранения данных между перезапусками.
    *   Для загрузчика: `bind mount` локальной папки с сырыми данными (только для чтения).
-  **Networks.** Все сервисы должны находиться в одной изолированной сети `backend-network`.
-  **Environment.** Переменные (логин/пароль БД, порты) вынести в файл `.env`. **Запрещено** хардкодить пароли в `docker-compose.yml`.

### Этап 3. Реализация Healthcheck и Init-контейнера
-  Добавить `healthcheck` для сервиса базы данных (проверка доступности порта или ответ на пинг).
-  Сервис `loader` должен запускаться только после того, как `db` перейдет в статус `healthy`.

---

## Варианты заданий (Кейсы)

Продолжаем работу с предметной областью из ЛР1.
**Бизнес-задача** — та же, что в ЛР1.
**Проектная задача** — какой компонент необходимо упаковать.
**Техническое задание** — специфическое требование к Docker/Compose для демонстрации углубленных навыков.

Задания на образовательном портале [IT-Adaptive](https://envlab.ru/mod/assign/view.php?id=14)

---

## Критерии оценки (Максимум 10 баллов)

| Критерий | Баллы | Требования к выполнению |
|:---|:---:|:---|
| **1. Качество Dockerfile (Best Practices)** | **3** | Dockerfile написан оптимально: используется фиксированная версия базового образа, команды `RUN` объединены, кэш очищается, используется **непривилегированный пользователь**, настроен `.dockerignore`. |
| **2. Оркестрация Docker Compose** | **3** | Файл `docker-compose.yml` корректен. Реализована связка минимум 3-х сервисов (`init/loader`, `db`, `app`). Настроены `depends_on` с учетом healthcheck (приложение реально ждет готовности БД). |
| **3. Конфигурация и Безопасность** | **2** | Отсутствие хардкода: пароли, порты и ключи вынесены в `.env` файл. Данные базы данных сохраняются в volume. Сеть настроена корректно. |
| **4. Выполнение технического задания варианта** | **1** | Реализована специфика варианта (например, Multi-stage build, настройка ресурсов, healthcheck для конкретной БД и т.д.). |
| **5. Отчет и Демонстрация** | **1** | В репозитории есть скриншоты (команда `docker ps`, логи успешного соединения App с DB, работающий интерфейс в браузере). Описана структура проекта в README. |


**Результат.** Ссылка на репозиторий GitHub/GitVerse (продолжение репозитория ЛР1), содержащий папку `lab_02` или обновленный корень проекта с Docker-конфигурацией.

